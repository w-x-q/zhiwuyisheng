<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>购物车</title>
    <link rel="stylesheet" href="css/shoppingcart.css">
</head>
<body>
    <div class="bigboxx">
		<div class="header">
			<ul>
				<li class="top_left">
					<a href="#" class="nav1"><span class="icon">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>专柜查询</span></a>
					<span class="nav2">|</span>
					<a href="#" class="nav3"><span>帮助中心</span></a>
				</li>
				<li class="top_midden">
					<a href="#">
						<img src="img/logo.png" alt="">
					</a>
					<h1>植物医生官方网站</h1>
				</li>
				<li class="top_right">
					<a href="#" class="nav1"><span>加盟合作</span></a>
					<span class="nav2">|</span>
					<a href="login.html" class="nav3"><span>登录与注册</span></a></li>
			</ul>
		</div>
	<!-- header -->
	<div id="navv">
	<div class="nav">
	<div class="nav_bot">
		<div class="nav_left" id="nav_left">
			<ul>
				<li><a href="index.html">首页</a></li>
				<li class="lis"><a href="#">高山植物护肤
				<span class="action"></span>
				</a></li>
				<li class="lis"><a href="#">探索高山植物
				 <span class="action"></span>
				</a></li>
				<li class="lis"><a href="#">品牌动态
				 <span class="action"></span>
				</a></li>
				<li class="lis"><a href="#">会员特权
				 <span class="action"></span>
				</a></li>
				<li class="lis"><a href="#">植粉专区
				 <span class="action"></span>
				</a></li>
			</ul>
			
		</div>
		<div class="nav_right">
			<form action="">
				 <input type="text" value="" placeholder="搜索" id="txtHeadKeyWord" name="q" onfocus="if(this.value=='搜索')this.value=''" maxlength="20" onkeyup="this.value = value.replace('*', '')" onafterpaste="this.value = value.replace('*', '')">
				<button type="submit" class="icon js-search"></button>
			</form>
		</div>
	</div>
	</div>
	<div class="small" id="small">
				<div class="boxmegg">            
						<div class="tab-content">
						   <dl>
							 <dt class="l"><a href="/node/230">产品类别：</a></dt>
								<dd class="l">
									   <a href="product.html">基础护理</a>
									   <a href="/node/235">面膜</a>
									   <a href="/node/260">洁面卸妆</a>
									   <a href="/node/306">防晒</a>
									   <a href="/node/307">面部底妆</a>
									   <a href="/node/308">精油</a>
									   <a href="/node/309">男士系列</a>
									   <a href="/node/340">彩妆</a>
									   <a href="/node/341">身体护理</a>
									   <a href="/node/342">美容工具</a>
									   <a href="/node/343">优惠套装</a>
							  </dd>
							</dl>
						   <dl>
							 <dt class="l"><a href="/node/410">产品系列：</a></dt>
								<dd class="l">
									   <a href="/node/620">兰精灵</a>
									   <a href="/node/420">石斛兰</a>
									   <a href="/node/630">野山参</a>
									   <a href="/node/422">紫灵芝</a>
									   <a href="/node/424">雪莲</a>
									   <a href="/node/421">元江芦荟</a>
									   <a href="/node/423">玉竹</a>
									   <a href="/node/425">山茶花</a>
									   <a href="/node/432">积雪草</a>
									   <a href="/node/426">野玫瑰</a>
									   <a href="/node/428">白茶</a>
									   <a href="/node/435">滇青瓜</a>
									   <a href="/node/614">其它系列</a>
							  </dd>
							</dl>
						   <dl>
							 <dt class="l"><a href="/node/612">明星系列：</a></dt>
								<dd class="l">
									   <a href="/node/613">中华仙草系列</a>
									   <a href="/node/621">兰精灵</a>
							  </dd>
							</dl>
						</div></div>
				<div class="boxmegg">            
						<div class="tab-content">
							<dl><dt class="l"><a href="/node/290">品牌定位：</a></dt>
								 <dd class="l">
									 <a href="/info/8711">品牌故事</a>
									 <a href="/info/8710">研发力量</a>
									 <a href="/info/8709">品牌科学家</a>
									 <a href="/info/8732">探秘高山植物</a>
								 </dd>
							</dl>
							<dl><dt class="l"><a href="/node/300">品牌历程：</a></dt>
								 <dd class="l">
									 <a href="/info/8714">历年大事件</a>
									 <a href="/info/8713">国礼历程</a>
									 <a href="/info/8712">荣誉见证</a>
								 </dd>
							</dl>
							<dl><dt class="l"><a href="/node/304">品牌公益：</a></dt>
								 <dd class="l">
									 <a href="/info/544">生物多样性-高山植物保护行动</a>
								 </dd>
							</dl>
						</div></div>
				<div class="boxmegg">            
						<div class="tab-content">
							
							<dl>
								 <dt class="l"><a href="javascript:void(0);"></a></dt>
								 <dd class="l">
									 <a href="/node/120">新品动态</a>
									 <a href="/node/153">品牌动态</a>
									 <a href="/node/510">公益动态</a>
									 <a href="/info/8716">海外动态</a>
								 </dd>
							</dl>
							 
						</div></div>
				<div class="boxmegg">            
						<div class="tab-content">
							
							<dl>
								 <dt class="l"><a href="javascript:void(0);"></a></dt>
								 <dd class="l">
									  <a href="/info/473">会员政策</a>
									  <a href="/info/8715">会员通道</a>
								 </dd>
							</dl>
							 
						</div></div>
				<div class="boxmegg">            
						<div class="tab-content">
							
							<dl>
								 <dt class="l"><a href="javascript:void(0);"></a></dt>
								 <dd class="l">
									 <a href="/node/550">达人分享</a>
									 <a href="/node/570">植粉问答</a>
									 <a href="/node/221">凝露专题</a>
									 <a href="/node/222">石斛兰专题</a>
									 <a href="/node/223">晚安面膜</a>
								 </dd>
							</dl>
							 
						</div>
				</div>		
			</div>
	</div>
    </div>
    <div class="shopping">
        <div class="sanbox">
        <p>已选商品<span>￥0</span><a class="jie">&nbsp;&nbsp;结&nbsp;&nbsp;&nbsp;算&nbsp;&nbsp;</a></p>
        </div> 
        <hr>
        <div class="shoppingnav">
            <span><input type="checkbox" id="allCheckBox">全选</span><span>商品信息</span>
            <span>单价</span><span>数量</span><span>金额</span><span>操作</span>
        </div>
        <ul class="shopplist" id="shopplist">
        
    </ul>
    <div class="sanbox sibox">
            <p>已选商品<span >合计：￥<span id="totalMoney">0</span></span><a class="jie">&nbsp;&nbsp;结&nbsp;&nbsp;&nbsp;算&nbsp;&nbsp;</a></p>
            </div>
    </div>
   <!-- foot -->
   <div class="footer">
        <div class="bottom-area">
            <div class="container clearfloat">
                <ul class="menu l">
                                    <li>
                        <ul class="menu-item">
                            <li> <p class="title">植物护肤</p> </li>
                            <li><a href="/node/234">基础护理</a></li>
                            <li><a href="/node/308">精油护理</a></li>
                            <li><a href="/node/235">面部护理</a></li>
                        </ul>
                    </li>
                    <li>
                        <ul class="menu-item">
                            <li> <p class="title">植粉社区</p> </li>
                            <li><a href="http://www.drplant.com.cn/query?index=1">植粉留言</a></li>
                            <li><a href="/node/570">植粉问答</a></li>
                        </ul>
                    </li>
                    <li>
                        <ul class="menu-item">
                            <li> <p class="title">品牌故事</p> </li>
                            <li><a href="/info/300">网站地图</a></li>
                            <li><a href="/node/510">公益事业</a></li>
                            <li><a href="/node/153">品牌资讯</a></li>
                        </ul>
                    </li>
                    <li>
                        <ul class="menu-item">
                            <li> <p class="title">加盟合作</p> </li>
                            <li><a href="/node/500">专卖店导航</a></li>
                            <li><a href="/info/316">加盟合作</a></li>
                        </ul>
                    </li>
                    
                    <li class="wx_img">
                        <img src="img/wx_img.png">
                    </li>
                    <li class="last_li">
                        <ul class="menu-item">
                            <li> <p class="title">联系植物医生</p> </li>
                            <li>加盟热线：010-66088228</li>
                            <li>客服热线：400-810-5889</li>
                            <li>互联网服务电话：010-56121888</li>
                            <li>客服邮箱：service@drplant.com.cn</li>
                        </ul>	
                    </li>
    
                </ul>
    
                <div class="bottom-bar l" id="trademark">
                    <p>Copyright©北京植物医生生物科技有限公司版权所有</p>
                    <p>地址：北京西城区西直门外大街1号院T1座10层D8-D9室&nbsp;&nbsp;&nbsp;&nbsp;网站使用条款：京ICP备09066495号－2号</p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/checkbox.js"></script>
<script src="js/cookise.js"></script>
<script>
window.onload = function(){
    var lis =  document.getElementsByClassName("lis");
	var divs = document.getElementsByClassName("boxmegg");
	var divd = document.getElementById("navv");
	var div = document.getElementById("small");
	var lll = div.children;
	for(var i=0;i<lis.length;i++){
		lis[i].num = i;
		lis[i].onmouseover = function(){
			for(var j=0; j<divs.length; j++){
				divs[j].style.display = "none";
			}
			divs[this.num].style.display = "block";
		}
		divd.onmouseleave=function(){
		 for(var s=0;s<lll.length;s++){
      
	      lll[s].style.display = "none";		
	      } 
	   }	
	} 
/////////////////////////////////////////发送请求	
let xhr = new XMLHttpRequest();
let cook=getCookie("vipName");
			xhr.open("get","php/getShoppingCart.php?vipName="+cook,true);
			xhr.onreadystatechange = function(){
			if(xhr.readyState==4 && xhr.status==200){
            let str = xhr.responseText;
            let objs = JSON.parse(str);
			let htmlStr="";
			for(let i=0;i<objs.length;i++){
				   htmlStr+=`<li class="wxq"><input type="checkbox">
                            <div class="shoppbox">
                            <p class="shoptite"><span id="bianhao">${objs[i].goodsId}</span>${objs[i].goodsName}</p>
                            <div class="shoppshow">
                            <div class="shleft">
                            <img src="${objs[i].goodsImg}" alt="">
                            </div>
                            <div class="shright">
                            <p>${objs[i].beiyong1}</p>
                            <div class="g1">
                            <span >￥<span class="price">${objs[i].goodsPrice}</span></span>
                            <div class="g2">
						    <input type="button" value="+" class="addbut">
						    <input type="text" class="count" value="${objs[i].goodsCount}" style="border:none;" id="count">
						    <input type="button"value="-" class="btnReduce">
						   <input type="button" value="删除" class="g3" onclick="shanchu()" index="${objs[i].goodsId}">
                           </div>
                        </div>
                       </div>
                </div>   
        </div>
        </li>`;
				}
			$("#shopplist").html(htmlStr);
		}
$(function(){

$(".addbut").click(function(){
	let $text = $(this).next();
	$text.val(parseInt($text.val())+1);
	calMoney();
//////////////////////////////////修改数量
     let xhr = new XMLHttpRequest();
			xhr.open("POST","php/updateGoodsCount.php",true);
			xhr.onreadystatechange = function(){
			if(xhr.readyState==4 && xhr.status==200){
                if(xhr.responseText==0){
				alert("修改失败");
            }else if(xhr.responseText==1){
				alert("修改成功");
            }
        }
    }
    let name=getCookie("vipName");
	let goodsid=$("#bianhao").html();
    let shuliang=$("#count").val();
	xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
	let sendstr = `vipName=${name}&goodsId=${goodsid}&goodsCount=${shuliang}`;
    xhr.send(sendstr);

});

$(".btnReduce").click(function(){
	let $text = $(this).prev();
	$text.val(parseInt($text.val())-1);
	calMoney();
	let xhr = new XMLHttpRequest();
			xhr.open("POST","php/updateGoodsCount.php",true);
			xhr.onreadystatechange = function(){
			if(xhr.readyState==4 && xhr.status==200){
                if(xhr.responseText==0){
				alert("修改失败");
            }else if(xhr.responseText==1){
				alert("修改成功");
            }
        }
    }
    let name=getCookie("vipName");
	let goodsid=$("#bianhao").html();
    let shuliang=$("#count").val();
	xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
	let sendstr = `vipName=${name}&goodsId=${goodsid}&goodsCount=${shuliang}`;
    xhr.send(sendstr);


});
  $("#allCheckBox").bindCheckBox($(".wxq :checkbox"),calMoney);
});
function calMoney(){
    let money = 0;
    let $subCheckBox = $(".wxq :checkbox");
    for(let i=0;i<$subCheckBox.length;i++){
        if($subCheckBox[i].checked){
            let $goodsBox = $($subCheckBox[i].parentNode);
            money += parseFloat($goodsBox.find(".price").html())*parseFloat($goodsBox.find(".count").val());
        }
    }
    $("#totalMoney").html(money);
}
	}
       xhr.send();  
}
////////////////////////////////////////////////////////////////

//////////////////////////////////////////删除
function shanchu(){
     let xhr = new XMLHttpRequest();
			xhr.open("POST","php/deleteGoods.php",true);
			xhr.onreadystatechange = function(){
			if(xhr.readyState==4 && xhr.status==200){
                if(xhr.responseText==0){
				alert("删除失败");
            }else if(xhr.responseText==1){
				alert("您已删除");
            }
        }
    }
	let name=getCookie("vipName");
    let goodsid=$("#bianhao").html();
	xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
	let sendstr = `vipName=${name}&goodsId=${goodsid}`;
    xhr.send(sendstr);
}
</script>